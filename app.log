2025-11-29 20:34:53,246 [ERROR] Exception in on_user_input_change: Traceback (most recent call last):
  File "C:\Users\User\Documents\Repositories\AI Engineering\RAGApp\front.py", line 72, in on_user_input_change
    response = get_openai_response(
        st.session_state.chat_history_raw,
        parameters=st.session_state.input
    )
  File "C:\Users\User\Documents\Repositories\AI Engineering\RAGApp\langChain_backend.py", line 83, in get_openai_response
    result = agent.invoke(
        {"messages": [history[-1]]},
        config={"configurable": {"thread_id": parameters["thread_id"]}}
    )
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\pregel\main.py", line 3068, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<10 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\pregel\main.py", line 2643, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\pregel\_runner.py", line 167, in tick
    run_with_retry(
    ~~~~~~~~~~~~~~^
        t,
        ^^
    ...<10 lines>...
        },
        ^^
    )
    ^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\pregel\_retry.py", line 42, in run_with_retry
    return task.proc.invoke(task.input, config)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\_internal\_runnable.py", line 656, in invoke
    input = context.run(step.invoke, input, config, **kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\_internal\_runnable.py", line 400, in invoke
    ret = self.func(*args, **kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 799, in _func
    outputs = list(
        executor.map(self._run_one, tool_calls, input_types, tool_runtimes)
    )
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py", line 619, in result_iterator
    yield _result_or_cancel(fs.pop())
          ~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py", line 317, in _result_or_cancel
    return fut.result(timeout)
           ~~~~~~~~~~^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py", line 456, in result
    return self.__get_result()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py", line 401, in __get_result
    raise self._exception
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\runnables\config.py", line 546, in _wrapped_fn
    return contexts.pop().run(fn, *args)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 1010, in _run_one
    return self._execute_tool_sync(tool_request, input_type, config)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 959, in _execute_tool_sync
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 916, in _execute_tool_sync
    response = tool.invoke(call_args, config)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\tools\base.py", line 605, in invoke
    return self.run(tool_input, **kwargs)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\tools\base.py", line 932, in run
    raise error_to_raise
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\tools\base.py", line 898, in run
    response = context.run(self._run, *tool_args, **tool_kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\tools\structured.py", line 93, in _run
    return self.func(*args, **kwargs)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Documents\Repositories\AI Engineering\RAGApp\langChain_backend.py", line 231, in retrieve_full_article_text_by_no
    article_text = resolve_full_document_by_article_no(
        article_no,
        date,
        "pm_chroma_db"
    )
  File "C:\Users\User\Documents\Repositories\AI Engineering\RAGApp\rag.py", line 162, in resolve_full_document_by_article_no
    result = vector_store.get(where=where)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_chroma\vectorstores.py", line 1123, in get
    return self._collection.get(**kwargs)  # type: ignore[arg-type, return-value]
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\models\Collection.py", line 130, in get
    get_request = self._validate_and_prepare_get_request(
        ids=ids,
    ...<2 lines>...
        include=include,
    )
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\models\CollectionCommon.py", line 103, in wrapper
    return func(self, *args, **kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\models\CollectionCommon.py", line 273, in _validate_and_prepare_get_request
    validate_filter_set(filter_set=filters)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\types.py", line 545, in validate_filter_set
    validate_where(filter_set["where"])
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\types.py", line 1107, in validate_where
    raise ValueError(f"Expected where to have exactly one operator, got {where}")
ValueError: Expected where to have exactly one operator, got {'article_no': '43', 'effective_from': {'$lte': 20251129}} in get.
During task with name 'tools' and id '756d8d13-80ed-1801-fa7a-ac8bb310805a'

2025-11-30 15:05:38,046 [ERROR] Exception in on_user_input_change: Traceback (most recent call last):
  File "C:\Users\User\Documents\Repositories\AI Engineering\RAGApp\Asistentas.py", line 74, in on_user_input_change
    response = eseimas_agent.get_agent_response(
        st.session_state.chat_history_raw[-1],
        parameters=st.session_state.input
    )
  File "C:\Users\User\Documents\Repositories\AI Engineering\RAGApp\ESeimasAgent.py", line 180, in get_agent_response
    result = agent.invoke(
        {"messages": [message]},
        config={"configurable": {"thread_id": parameters["thread_id"]}}
    )
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\pregel\main.py", line 3068, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<10 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\pregel\main.py", line 2643, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\pregel\_runner.py", line 167, in tick
    run_with_retry(
    ~~~~~~~~~~~~~~^
        t,
        ^^
    ...<10 lines>...
        },
        ^^
    )
    ^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\pregel\_retry.py", line 42, in run_with_retry
    return task.proc.invoke(task.input, config)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\_internal\_runnable.py", line 656, in invoke
    input = context.run(step.invoke, input, config, **kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\_internal\_runnable.py", line 400, in invoke
    ret = self.func(*args, **kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 799, in _func
    outputs = list(
        executor.map(self._run_one, tool_calls, input_types, tool_runtimes)
    )
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py", line 619, in result_iterator
    yield _result_or_cancel(fs.pop())
          ~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py", line 317, in _result_or_cancel
    return fut.result(timeout)
           ~~~~~~~~~~^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py", line 456, in result
    return self.__get_result()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\_base.py", line 401, in __get_result
    raise self._exception
  File "C:\Users\User\AppData\Local\Programs\Python\Python313\Lib\concurrent\futures\thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\runnables\config.py", line 546, in _wrapped_fn
    return contexts.pop().run(fn, *args)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 1010, in _run_one
    return self._execute_tool_sync(tool_request, input_type, config)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 959, in _execute_tool_sync
    content = _handle_tool_error(e, flag=self._handle_tool_errors)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 424, in _handle_tool_error
    content = flag(e)  # type: ignore [assignment, call-arg]
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 381, in _default_handle_tool_errors
    raise e
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langgraph\prebuilt\tool_node.py", line 916, in _execute_tool_sync
    response = tool.invoke(call_args, config)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\tools\base.py", line 605, in invoke
    return self.run(tool_input, **kwargs)
           ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\tools\base.py", line 932, in run
    raise error_to_raise
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\tools\base.py", line 898, in run
    response = context.run(self._run, *tool_args, **tool_kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\tools\structured.py", line 93, in _run
    return self.func(*args, **kwargs)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Documents\Repositories\AI Engineering\RAGApp\ESeimasAgent.py", line 70, in retrieve_context
    retrieved_docs = agent.store.query(query, date)
  File "C:\Users\User\Documents\Repositories\AI Engineering\RAGApp\Store.py", line 66, in query
    result = vector_store.similarity_search_with_relevance_scores(query, k=10, filter=filter)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\vectorstores\base.py", line 523, in similarity_search_with_relevance_scores
    docs_and_similarities = self._similarity_search_with_relevance_scores(
        query, k=k, **kwargs
    )
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\vectorstores\base.py", line 471, in _similarity_search_with_relevance_scores
    docs_and_scores = self.similarity_search_with_score(query, k, **kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_chroma\vectorstores.py", line 796, in similarity_search_with_score
    results = self.__query_collection(
        query_embeddings=[query_embedding],
    ...<3 lines>...
        **kwargs,
    )
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_core\utils\utils.py", line 52, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\langchain_chroma\vectorstores.py", line 470, in __query_collection
    return self._collection.query(
           ~~~~~~~~~~~~~~~~~~~~~~^
        query_texts=query_texts,
        ^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\models\Collection.py", line 215, in query
    query_request = self._validate_and_prepare_query_request(
        query_embeddings=query_embeddings,
    ...<7 lines>...
        include=include,
    )
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\models\CollectionCommon.py", line 103, in wrapper
    return func(self, *args, **kwargs)
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\models\CollectionCommon.py", line 329, in _validate_and_prepare_query_request
    validate_filter_set(filter_set=filters)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\types.py", line 545, in validate_filter_set
    validate_where(filter_set["where"])
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\User\Documents\Repositories\AI Engineering\RAGApp\.venv\Lib\site-packages\chromadb\api\types.py", line 1107, in validate_where
    raise ValueError(f"Expected where to have exactly one operator, got {where}")
ValueError: Expected where to have exactly one operator, got {'effective_from': {'$lte': 20251130}, 'effective_to': {'$gte': 20251130}, 'title': {'$ne': 'Pakeitimai:'}} in query.
During task with name 'tools' and id '0109d83b-33cd-6b8f-c06a-22c65f4df5f9'

